<div class="usuarios-section">
  <h2>Usuarios</h2>
  <!-- Caja de b√∫squeda -->
  <div class="search-container">
    <label for="search">Buscar Usuario por Nombre:</label>
    <input
      type="text"
      id="search"
      placeholder="Escribe para buscar..."
      (ngModelChange)="filtrarUsuarios()"
    />
  </div>
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>ID Usuario</th>
          <th>Nombre</th>
          <th>Nombre Usuario</th>
          <th>Contrase√±a</th>
          <th>ID Rol</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of usuarios">
          <td>{{ usuario.IdUsuario }}</td>
          <td>{{ usuario.Nombre }}</td>
          <td>{{ usuario.NombreUsuario }}</td>
          <td>
            <span
              [ngClass]="{
                'hidden-text': !mostrarContrasenas[usuario.IdUsuario]
              }"
            >
              {{ usuario.Contrasenya }}
            </span>
            <button
              class="password"
              (mousedown)="mostrarContrasena(usuario.IdUsuario)"
              (mouseup)="ocultarContrasena(usuario.IdUsuario)"
              (mouseleave)="ocultarContrasena(usuario.IdUsuario)"
            >
              üëÅÔ∏è
            </button>
          </td>
          <td>{{ usuario.IdRol }}</td>
          <td>
            <button (click)="toggleActualizarUsuario(usuario)">
              Actualizar
            </button>
            <button (click)="borrarUsuario(usuario.IdUsuario)">Borrar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="form-container" *ngIf="usuarioParaActualizar">
    <h3>Actualizar Usuario</h3>
    <form [formGroup]="usuarioForm"   (ngSubmit)="actualizarUsuario()">
      <label for="idUsuario">ID Usuario:</label>
      <input
        type="number"
        id="idUsuario"
        formControlName="IdUsuario"
      />
      <label for="nombre">Nombre:</label>
      <input
        type="text"
        id="nombre"
        formControlName="Nombre"
      />
      <label for="nombreUsuario">Nombre Usuario:</label>
      <input
        type="text"
        id="nombreUsuario"
        formControlName="NombreUsuario"
      />
      <label for="contrasenya">Contrase√±a:</label>
      <input
        type="password"
        id="contrasenya"
        formControlName="Contrasenya"
      />
      <label for="idRol">ID Rol:</label>
      <input
        type="number"
        id="idRol"
        formControName="IdRol"
      />
      <div class="botones">
        <button type="submit">Guardar</button>
        <button type="button" (click)="cancelarActualizarUsuario()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <div class="form-container">
    <h3>Agregar Usuario</h3>
    <form [formGroup]="usuarioForm" (ngSubmit)="agregarUsuario()">
      <label for="nombre">Nombre completo:</label>
      <input
        type="text"
        id="nombre"
        formControlName="Nombre"
        required
      />
      <div *ngIf="usuarioForm.get('Nombre')?.invalid && usuarioForm.get('Nombre')?.touched">
        <small class="alert-message">El nombre es requerido.</small>
      </div>
  
      <label for="nombreUsuario">Nombre de usuario:</label>
      <input
        type="text"
        id="nombreUsuario"
        formControlName="NombreUsuario"
        required
      />
      <div *ngIf="usuarioForm.get('NombreUsuario')?.invalid && usuarioForm.get('NombreUsuario')?.touched">
        <small>El nombre de usuario es requerido.</small>
      </div>
  
      <label for="contrasenya">Contrase√±a:</label>
      <input
        type="password"
        id="contrasenya"
        formControlName="Contrasenya"
        required
      />
      <div *ngIf="usuarioForm.get('Contrasenya')?.invalid && usuarioForm.get('Contrasenya')?.touched">
        <small>La contrase√±a es requerida.</small>
      </div>
  
      <label for="idRol">Rol:</label>
      <select formControlName="IdRol" required>
        <option [value]="0" disabled>Selecciona un rol</option>
        <option *ngFor="let rol of roles" [value]="rol.IdRol">
          {{ rol.NombreRol }}
        </option>
      </select>
      <div *ngIf="usuarioForm.get('IdRol')?.invalid && usuarioForm.get('IdRol')?.touched">
        <small>El rol es requerido.</small>
      </div>
  
      <div class="botones">
        <button type="submit" [disabled]="usuarioForm.invalid">Guardar</button>
        <button type="button" (click)="cancelarNuevoUsuario()">Cancelar</button>
      </div>
    </form>
  </div>  
</div>
